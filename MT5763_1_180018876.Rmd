---
title: "Bike Share Analysis"
author: "Matthew Coudert"
date: "Saturday September 26th"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Downloading Packages Needed
```{r packages}
library(tidyverse)
library(ggplot2)
library(lubridate)
```

## Saving datasets
```{r datasets}
washington_dataset <- read_csv("BikeWashingtonDC.csv")
seoul_dataset <- read_csv("BikeSeoul.csv")
```

## Seoul dataset clean up
```{r seoul_dataset}
seoul_dataset <- seoul_dataset %>%
  select(-c('Visibility (10m)','Dew point temperature(C)','Solar Radiation (MJ/m2)','Rainfall(mm)','Snowfall (cm)','Functioning Day')) %>% 
  filter(!is.na('Rented Bike Count')) %>%
  rename(Date = 'Date',Count = 'Rented Bike Count',Hour = 'Hour', Temperature = 'Temperature(C)', Humidity = 'Humidity(%)', WindSpeed = 'Wind speed (m/s)', Season = 'Seasons', Holiday = 'Holiday') %>%
  mutate(Date = parse_date_time(Date,"dmy")) %>%
  mutate(FullDate = make_datetime(year = year(Date), month = month(Date), day = day(Date), hour = Hour)) %>%
  select(-c(Date,Hour)) %>%
  mutate(Holiday = factor(ifelse(Holiday == "Holiday", "Yes", "No"), levels = c("Yes","No"))) %>%
  mutate(Season = ordered(Season, levels = c("Spring","Summer","Autumn","Winter"))) %>%
  print()
```

## Washington DC dataset clean up
```{r washington_dataset}
washington_dataset <- washington_dataset %>%
  select(c('dteday','cnt','hr','temp','hum','windspeed','season','holiday')) %>%
  rename(Date = 'dteday', Count = 'cnt', Hour = 'hr', Temperature = 'temp', Humidity = 'hum', WindSpeed = 'windspeed', Season = 'season', Holiday = 'holiday') %>%
  mutate(Humidity = Humidity*100) %>%
  mutate(Temperature = Temperature*(39-(-8))+(-8)) %>%
  mutate(WindSpeed = WindSpeed*67*1000/60^2) %>%
  mutate(Season = ifelse(Season == 1, "Winter", Season)) %>%
  mutate(Season = ifelse(Season == 2, "Spring", Season)) %>%
  mutate(Season = ifelse(Season == 3, "Summer", Season)) %>%
  mutate(Season = ifelse(Season == 4, "Autumn", Season)) %>%
  mutate(Season = ordered(Season, levels = c("Spring","Summer","Autumn","Winter"))) %>%
  mutate(Holiday = factor(ifelse(Holiday == 1, "Yes", "No"), levels = c("Yes","No"))) %>%
  mutate(Date = parse_date_time(Date,"ymd")) %>%
  mutate(FullDate = make_datetime(year = year(Date), month = month(Date), day = day(Date), hour = Hour)) %>%
  select(-c(Date,Hour)) %>%
  print()
```


## Creating big dataset with both Seoul and Washington DC
```{r big_dataset}
seoul_dataset <- seoul_dataset %>%
  mutate(City = "Seoul")
washington_dataset <- washington_dataset %>%
  mutate(City = "Washington DC")
dataset <- seoul_dataset %>%
  add_row(washington_dataset) %>%
  arrange(Count)
```


## Temperature v Day Plot
```{r temp_v_day}
temp <- dataset %>%
  ggplot(aes(x = yday(FullDate), y = Temperature)) + 
  geom_point() + 
  xlab("Day of year from January 1st") +
  ylab("Temperature (C)")+
  stat_smooth(data = dataset, mapping = aes(x = yday(FullDate), y = Temperature)) +
  facet_wrap(~City) +
  ggtitle("Temperature over the year in Washington DC and Seoul")
temp
```

## Plotting season v bike demand
```{r season_v_bike_demand}
require(gridExtra)
season_seoul_dataset <- seoul_dataset %>%
  select(c("Season","Count"))
season_washington_dataset <- washington_dataset %>%
  select(c("Season","Count"))
season_plot_seoul <- season_seoul_dataset %>%
  ggplot(aes(x = Season, y = Count, colour = "Seoul")) + 
  geom_boxplot()
season_plot_washington <- season_washington_dataset %>%
  ggplot(aes(x = Season, y = Count, colour = "Washington DC")) + 
  geom_boxplot()
grid.arrange(season_plot_seoul,season_plot_washington, ncol = 2)
```

## Plotting holiday v bike demand
```{r holiday_v_bike_demand}
holiday_seoul_dataset <- seoul_dataset %>%
  select(c("Season","Count","Holiday"))
holiday_washington_dataset <- washington_dataset %>%
  select(c("Season","Count","Holiday"))
holiday_washington_dataset %>% filter(Season == "Winter", Holiday == "Yes") %>% summarise(n = n())
holiday_washington_dataset %>% filter(Season == "Spring", Holiday == "Yes") %>% summarise(n = n())
holiday_washington_dataset %>% filter(Season == "Summer", Holiday == "Yes") %>% summarise(n = n())
holiday_washington_dataset %>% filter(Season == "Autumn", Holiday == "Yes") %>% summarise(n = n())



```

